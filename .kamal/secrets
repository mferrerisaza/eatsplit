# Secrets are fetched from 1Password - secure and easy to manage!
# Make sure you have 1Password CLI installed and signed in

# Fetch secrets from 1Password
SECRETS=$(kamal secrets fetch --adapter 1password --account my.1password.com --from "Kamal Deployment/Eatsplit Deployment" KAMAL_REGISTRY_PASSWORD DATABASE_URL SECRET_KEY_BASE CLOUDINARY_URL GOOGLE_BACKEND_API GOOGLE_FRONTEND_API)

# Extract individual secrets from the fetched data
KAMAL_REGISTRY_PASSWORD=$(kamal secrets extract KAMAL_REGISTRY_PASSWORD ${SECRETS})
DATABASE_URL=$(kamal secrets extract DATABASE_URL ${SECRETS})
SECRET_KEY_BASE=$(kamal secrets extract SECRET_KEY_BASE ${SECRETS})
CLOUDINARY_URL=$(kamal secrets extract CLOUDINARY_URL ${SECRETS})
GOOGLE_BACKEND_API=$(kamal secrets extract GOOGLE_BACKEND_API ${SECRETS})
GOOGLE_FRONTEND_API=$(kamal secrets extract GOOGLE_FRONTEND_API ${SECRETS})

# NOTE: In 1Password, create an item named "Eatsplit Deployment" with these fields:
# - KAMAL_REGISTRY_PASSWORD: Your GitHub Personal Access Token (same as Its Listed)
# - DATABASE_URL: postgresql://postgres:PASSWORD@infrastructure-postgres:5432/eatsplit_production
#   (PASSWORD must match POSTGRES_PASSWORD from infrastructure)
# - SECRET_KEY_BASE: Generate with `bundle exec rails secret` (128 character hex string)
# - CLOUDINARY_URL: cloudinary://api_key:api_secret@cloud_name
# - GOOGLE_BACKEND_API: Your Google Maps Backend API key
# - GOOGLE_FRONTEND_API: Your Google Maps Frontend API key
